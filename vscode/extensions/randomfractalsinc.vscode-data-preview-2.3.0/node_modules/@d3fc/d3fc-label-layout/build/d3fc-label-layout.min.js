(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-selection"),require("d3-scale"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-scale","d3-array"],b):(a=a||self,b(a.fc=a.fc||{},a.d3,a.d3,a.d3))})(this,function(a,b,c,d){'use strict';function e(a){return f(a)||g(a)||h()}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function g(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var i=function(a){return"function"==typeof a?a:function(){return a}};const j=1e-6;var k=(a,b)=>{a=a||"g";let c=(a,b)=>b,d=null;const e=function(e,f){f=f||(a=>a);const g=e.selection?e:null;g&&(e=e.selection());const h=e.selectAll((a,b,c)=>Array.from(c[b].childNodes).filter(a=>1===a.nodeType)).filter(null==b?a:`${a}.${b}`);let i=h.data(f,c);const k=i.enter().append(a).attr("class",b);let l=i.exit();i=i.merge(k);const m=g||d;return m&&(i=i.transition(m).style("opacity",1),k.style("opacity",j),l=l.transition(m).style("opacity",j)),l.remove(),i.enter=()=>k,i.exit=()=>l,i};return e.element=(...b)=>b.length?(a=b[0],e):a,e.className=(...a)=>a.length?(b=a[0],e):b,e.key=(...a)=>a.length?(c=a[0],e):c,e.transition=(...a)=>a.length?(d=a[0],e):d,e},l=(a,b,c)=>{const d=b[c];if("function"!=typeof d)throw new Error(`Attempt to rebind ${c} which isn't a function on the source object`);return(...c)=>{var e=d.apply(b,c);return e===b?a:e}};const m=a=>b=>a.reduce((a,b)=>a&&b(a),b);var n=(a,b,...c)=>{const d=m(c);for(const e of Object.keys(b)){const c=d(e);c&&(a[c]=l(a,b,e))}return a},o=a=>a.map(a=>"string"==typeof a?new RegExp(`^${a}$`):a),p=(...a)=>(a=o(a),b=>a.some(a=>a.test(b))&&b),q=function(c,a){return!(c.x>=a.x+a.width||c.x+c.width<=a.x||c.y>=a.y+a.height||c.y+c.height<=a.y)},r=function(c,a){var b=Math.min,d=Math.max;if(q(c,a)){var e=d(c.x,a.x),f=b(c.x+c.width,a.x+a.width),g=d(c.y,a.y),h=b(c.y+c.height,a.y+a.height);return(f-e)*(h-g)}return 0},s=function(a,b){return d.sum(a.map(function(c,d){return b===d?0:r(a[b],c)}))},t=function(a,b,c,d,e){return{x:a,y:b,width:c,height:d,location:e}},u=function(a){var b=a.x,c=a.y,d=a.width,e=a.height;return[t(b,c,d,e,"bottom-right"),t(b-d,c,d,e,"bottom-left"),t(b-d,c-e,d,e,"top-left"),t(b,c-e,d,e,"top-right"),t(b,c-e/2,d,e,"middle-right"),t(b-d/2,c,d,e,"bottom-center"),t(b-d,c-e/2,d,e,"middle-left"),t(b-d/2,c-e,d,e,"top-center")]},v=function(a,b,c){return[].concat(e(a.slice(0,b)),[c],e(a.slice(b+1)))},w=function(c,a){return c<a},x=function a(){var b,c=null,e=w,f=function(){return 0},g=function(a,d){return c-f(b[d],d,b)+f(a,d,v(b,d,a))},h=function h(i,j){c||(c=d.sum(b.map(function(a,c){return f(a,c,b)})));var k=g(i,j);return e(k,c)?a().locationScore(f).winningScore(e).score(k).rectangles(v(b,j,i)):h};return h.rectangles=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],h):b},h.score=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],h):c},h.winningScore=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],h):e},h.locationScore=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],h):f},h},y=function(a){return a[z(a)]},z=function(a){return Math.floor(Math.random()*a.length)},A=function(a,b){return a[d.scan(a,b)]};a.layoutAnnealing=function(){var a,b=1e3,c=1,d=function(a){switch(a.location){case"bottom-right":return 0;case"middle-right":case"bottom-center":return a.width*a.height/8;}return a.width*a.height/4},e=function(b){return a?b.width*b.height-r(b,a):0},f=function(a,b,c){return s(c,b)+e(a)+d(a)},g=function(a){for(var d=b,e=function(a,b){var c=Math.exp;return c((b-a)/d)>Math.random()},g=x().locationScore(f).winningScore(e).rectangles(a);0<d;){var h=z(a),i=y(u(a[h]));g=g(i,h),d-=c}return g.rectangles()};return g.temperature=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],g):b},g.cooling=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],g):c},g.bounds=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],g):a},g},a.layoutBoundingBox=function(){var a=[0,0],b=function(b){return b.map(function(b){var c=b.x,d=b.y;return c+b.width>a[0]&&(c-=b.width),d+b.height>a[1]&&(d-=b.height),{height:b.height,width:b.width,x:c,y:d}})};return b.bounds=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],b):a},b},a.layoutGreedy=function(){var a,b=function(b){return a?b.width*b.height-r(b,a):0},c=function(a,c,d){return s(d,c)+b(a)},d=function(a){var b=x().locationScore(c).rectangles(a);return a.forEach(function(a,c){u(a).forEach(function(a){b=b(a,c)})}),b.rectangles()};return d.bounds=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],d):a},d},a.layoutLabel=function(a){var d=function(){},e=function(){return[0,0]},f=function(a){return[a.x,a.y]},h=a||function(a){return a},j=function(){},l=c.scaleIdentity(),m=c.scaleIdentity(),o=k("g","label"),q=function(a){a.each(function(a,c,i){var k=o(b.select(i[c]),a).call(j),g=k.nodes(),n=g.map(function(a,c){var h=b.select(a).datum(),d=f(h,c,g),i=[l(d[0]),m(d[1])],j=e(h,c,g);return{hidden:!1,x:i[0],y:i[1],width:j[0],height:j[1]}}),p=h(n);k.attr("style",function(a,b){return"display:"+(p[b].hidden?"none":"inherit")}).attr("transform",function(a,b){return"translate("+p[b].x+", "+p[b].y+")"}).attr("layout-width",function(a,b){return p[b].width}).attr("layout-height",function(a,b){return p[b].height}).attr("anchor-x",function(a,b){return n[b].x-p[b].x}).attr("anchor-y",function(a,b){return n[b].y-p[b].y}),k.call(j),d(k,a,c)})};return n(q,o,p("key")),n(q,h),q.size=function(){return arguments.length?(e=i(0>=arguments.length?void 0:arguments[0]),q):e},q.position=function(){return arguments.length?(f=i(0>=arguments.length?void 0:arguments[0]),q):f},q.component=function(){return arguments.length?(j=0>=arguments.length?void 0:arguments[0],q):j},q.decorate=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],q):d},q.xScale=function(){return arguments.length?(l=0>=arguments.length?void 0:arguments[0],q):l},q.yScale=function(){return arguments.length?(m=0>=arguments.length?void 0:arguments[0],q):m},q},a.layoutRemoveOverlaps=function(a){a=a||function(a){return a};var b=function(b){b=a(b);for(var c,d=function(){var a=b.filter(function(a){return!a.hidden}),c=a.map(function(b,c){return[b,s(a,c)]}),d=A(c,function(c,a){return a[1]-c[1]});return 0<d[1]?void(d[0].hidden=!0):"break"};c=d(),"break"!==c;);return b};return n(b,a),b},a.layoutTextLabel=function(){var a=2,c=function(a){return a},d=k("text"),e=k("rect"),f=k("circle"),g=function(g){g.each(function(g,h,i){var j=i[h],k=b.select(j),l=+j.getAttribute("layout-width"),m=+j.getAttribute("layout-height"),n=e(k,[g]);n.attr("width",l).attr("height",m);var o=+j.getAttribute("anchor-x"),p=+j.getAttribute("anchor-y"),q=f(k,[g]);q.attr("r",2).attr("cx",o).attr("cy",p);var r=d(k,[g]);r.enter().attr("dy","0.9em").attr("transform","translate(".concat(a,", ").concat(a,")")),r.text(c)})};return g.padding=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],g):a},g.value=function(){return arguments.length?(c=i(0>=arguments.length?void 0:arguments[0]),g):c},g},Object.defineProperty(a,"__esModule",{value:!0})});
