(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-scale"),require("d3-selection"),require("d3-path"),require("d3-shape"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-selection","d3-path","d3-shape","d3-array"],b):(a=a||self,b(a.fc=a.fc||{},a.d3,a.d3,a.d3,a.d3,a.d3))})(this,function(a,b,c,d,e){'use strict';function f(){const a=arguments;return function(b,d){for(let e=0,c=a.length;e<c;e++)if(null==a[e](b,d))return!1;return!0}}function g(a){return h(a)||i(a)||j()}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function i(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function j(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var k="default"in b?b["default"]:b,l="default"in e?e["default"]:e;const m=1e-6;var n=(a,b)=>{a=a||"g";let c=(a,b)=>b,d=null;const e=function(e,f){f=f||(a=>a);const g=e.selection?e:null;g&&(e=e.selection());const h=e.selectAll((a,b,c)=>Array.from(c[b].childNodes).filter(a=>1===a.nodeType)).filter(null==b?a:`${a}.${b}`);let i=h.data(f,c);const j=i.enter().append(a).attr("class",b);let k=i.exit();i=i.merge(j);const l=g||d;return l&&(i=i.transition(l).style("opacity",1),j.style("opacity",m),k=k.transition(l).style("opacity",m)),k.remove(),i.enter=()=>j,i.exit=()=>k,i};return e.element=(...b)=>b.length?(a=b[0],e):a,e.className=(...a)=>a.length?(b=a[0],e):b,e.key=(...a)=>a.length?(c=a[0],e):c,e.transition=(...a)=>a.length?(d=a[0],e):d,e},o=a=>"function"==typeof a?a:()=>a,p=()=>{let a=null,b=a=>a.x,c=a=>a.y,e="center",f="center",g=a=>a.height,h=o(3);const i=function(i,j){const k=a||d.path();return i.forEach(function(a,d){const i=b.call(this,a,j||d),l=c.call(this,a,j||d),m=g.call(this,a,j||d),n=h.call(this,a,j||d);let o;switch(e){case"left":o=n;break;case"right":o=0;break;case"center":o=n/2;break;default:throw new Error("Invalid horizontal alignment "+e);}let p;switch(f){case"bottom":p=-m;break;case"top":p=0;break;case"center":p=m/2;break;default:throw new Error("Invalid vertical alignment "+f);}k.rect(i-o,l-p,n,m)},this),a?null:k.toString()};return i.context=(...b)=>b.length?(a=b[0],i):a,i.x=(...a)=>a.length?(b=o(a[0]),i):b,i.y=(...a)=>a.length?(c=o(a[0]),i):c,i.width=(...a)=>a.length?(h=o(a[0]),i):h,i.horizontalAlign=(...a)=>a.length?(e=a[0],i):e,i.height=(...a)=>a.length?(g=o(a[0]),i):g,i.verticalAlign=(...a)=>a.length?(f=a[0],i):f,i},q=function(a){return"function"==typeof a?a:function(){return a}},r=(a,b,c)=>{const d=b[c];if("function"!=typeof d)throw new Error(`Attempt to rebind ${c} which isn't a function on the source object`);return(...c)=>{var e=d.apply(b,c);return e===b?a:e}},s=(a,b,...c)=>{for(const d of c)a[d]=r(a,b,d);return a};const t=a=>b=>a.reduce((a,b)=>a&&b(a),b);var u=(a,b,...c)=>{const d=t(c);for(const e of Object.keys(b)){const c=d(e);c&&(a[c]=r(a,b,e))}return a},v=a=>a.map(a=>"string"==typeof a?new RegExp(`^${a}$`):a),w=(...a)=>(a=v(a),b=>a.every(a=>!a.test(b))&&b),z=(...a)=>(a=v(a),b=>a.some(a=>a.test(b))&&b),A=a=>b=>a[b];const B=a=>a[0].toUpperCase()+a.slice(1);var C=a=>b=>a+B(b),D=function(){var a=b.scaleIdentity(),d=b.scaleIdentity(),e=function(a){return a},f=e,h=function(){},i="horizontal",j=n("g","annotation-line"),k=function(b){if(b.selection&&j.transition(b),"horizontal"!==i&&"vertical"!==i)throw new Error("Invalid orientation");var g="horizontal"===i,k=g?function(c,a){return"translate(".concat(c,", ").concat(a,")")}:function(c,a){return"translate(".concat(a,", ").concat(c,")")},l=g?"x2":"y2",m=g?a:d,n=g?d:a,o=g?"left-handle":"bottom-handle",p=g?"right-handle":"top-handle",q=g?"9":"0",r=g?"0":"9",s=g?"0.32em":"0.71em",t=g?"start":"middle",u=m.range(),v=function(){return k(u[0],n(e.apply(void 0,arguments)))},w=u[1]-u[0];b.each(function(a,b,d){var e=j(c.select(d[b]),a),g=e.enter().attr("transform",v).style("stroke","#bbb");g.append("line").attr(l,w),g.append("g").classed(o,!0).style("stroke","none"),g.append("g").classed(p,!0).style("stroke","none").attr("transform",k(w,0)).append("text").attr("text-anchor",t).attr("x",q).attr("y",r).attr("dy",s),e.attr("class","annotation-line ".concat(i)),e.attr("transform",v),e.select("line").attr(l,w),e.select("g."+p).attr("transform",k(w,0)),e.select("text").text(f),h(e,a,b)})};return k.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],k):a},k.yScale=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],k):d},k.value=function(){return arguments.length?(e=q(0>=arguments.length?void 0:arguments[0]),k):e},k.label=function(){return arguments.length?(f=q(0>=arguments.length?void 0:arguments[0]),k):f},k.decorate=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],k):h},k.orient=function(){return arguments.length?(i=0>=arguments.length?void 0:arguments[0],k):i},k},E=a=>"function"==typeof a?a:()=>a,F=(a,b)=>"left"===a?b/2:"right"===a?-b/2:0,G=a=>{const b=Object.assign({},a),c=()=>{};return Object.keys(b).forEach(a=>{c[a]=(...d)=>d.length?(b[a]=d[0],c):b[a]}),c},H=()=>{let a=()=>0,c=a=>a.x,e=a=>a.y,g="center",h=()=>5,j="vertical";const k=G({decorate:()=>{},defined:(b,d)=>f(a,c,e)(b,d),xScale:b.scaleIdentity(),yScale:b.scaleIdentity()});return k.values=(b,d)=>{const f=h(b,d),i=F(g,f),l=k.xScale(),m=k.yScale();if("vertical"===j){const g=m(e(b,d),d),h=m(a(b,d),d),j=l(c(b,d),d)+i;return{d:b,x:j,y:g,y0:h,width:f,height:g-h,origin:[j,g],baseOrigin:[j,h],transposedX:j,transposedY:g}}else{const g=l(e(b,d),d),h=l(a(b,d),d),j=m(c(b,d),d)+i;return{d:b,x:j,y:g,y0:h,width:f,height:g-h,origin:[g,j],baseOrigin:[h,j],transposedX:g,transposedY:j}}},k.xValues=()=>"vertical"===j?[c]:[a,e],k.yValues=()=>"vertical"===j?[a,e]:[c],k.baseValue=(...b)=>b.length?(a=E(b[0]),k):a,k.crossValue=(...a)=>a.length?(c=E(a[0]),k):c,k.mainValue=(...a)=>a.length?(e=E(a[0]),k):e,k.bandwidth=(...a)=>a.length?(h=E(a[0]),k):h,k.align=(...a)=>a.length?(g=a[0],k):g,k.orient=(...a)=>a.length?(j=a[0],k):j,k};var I={red:"#c60",green:"#6c0",black:"#000",gray:"#ddd",darkGray:"#999"},J=()=>{const a=e.symbol(),b=H(),d=n("g","point"),f=a=>"translate("+a[0]+", "+a[1]+")",g=e=>{e.selection&&d.transition(e),e.each((e,h,i)=>{const j=e.filter(b.defined()),k=d(c.select(i[h]),j);k.enter().attr("transform",(a,c)=>f(b.values(a,c).origin)).attr("fill",I.gray).attr("stroke",I.black).append("path"),k.attr("transform",(a,c)=>f(b.values(a,c).origin)).select("path").attr("d",a),b.decorate()(k,e,h)})};return u(g,b,w("baseValue","bandwidth","align")),s(g,d,"key"),s(g,a,"type","size"),g},K=()=>{const a=e.symbol(),b=H(),c=c=>{const d=c.filter(b.defined()),e=a.context();d.forEach((c,d)=>{e.save();const f=b.values(c,d);e.translate(f.origin[0],f.origin[1]),e.beginPath(),a(c,d),e.strokeStyle=I.black,e.fillStyle=I.gray,b.decorate()(e,c,d),e.fill(),e.stroke(),e.closePath(),e.restore()})};return u(c,b,w("baseValue","bandwidth","align")),s(c,a,"size","type","context"),c},L=()=>{let a=[],c=a=>a,d=(a,b)=>b;const e=G({decorate:()=>{},xScale:b.scaleIdentity(),yScale:b.scaleIdentity()});return e.xValues=()=>a.map(a=>a.xValues()).reduce((c,a)=>c.concat(a)),e.yValues=()=>a.map(a=>a.yValues()).reduce((c,a)=>c.concat(a)),e.mapping=(...a)=>a.length?(c=a[0],e):c,e.key=(...a)=>a.length?(d=a[0],e):d,e.series=(...b)=>b.length?(a=b[0],e):a,e},M=()=>{const a=L(),b=n("g"),d=n("g","multi"),e=e=>{e.selection&&(d.transition(e),b.transition(e));const f=a.mapping(),g=a.series(),h=a.xScale(),i=a.yScale();e.each((e,j,k)=>{const l=d(c.select(k[j]),g);l.each((a,d,j)=>{a.xScale(h).yScale(i);const k=f(e,d,g),l=b(c.select(j[d]),[k]);l.call(a)});const m=l.selection?l.selection():l;m.order(),a.decorate()(l,e,j)})};return u(e,a),s(e,d,"key"),e},N=()=>{let a=null;const b=L(),c=e=>{const f=b.mapping(),g=b.series(),h=b.xScale(),i=b.yScale();g.forEach((c,j)=>{const k=f(e,j,g);c.context(a).xScale(h).yScale(i);let l;c.decorate?(l=c.decorate(),c.decorate((a,c,d)=>{b.decorate()(a,e,j),l(a,c,d)})):b.decorate()(a,e,j),c(k),l&&c.decorate(l)})};return c.context=(...b)=>b.length?(a=b[0],c):a,u(c,b),c},O=function(){var a=b.scaleIdentity(),c=b.scaleIdentity(),f=function(a){return a},g=f,h=function(){},i="horizontal",j=e.line(),k=function(b){if("horizontal"!==i&&"vertical"!==i)throw new Error("Invalid orientation");var e="horizontal"===i,k=j.context(),l=e?a:c,m=e?c:a,n=l.domain(),o=e?9:0,p=e?0:9,q=e?"left":"center",r=e?"middle":"hanging";b.forEach(function(a,b){k.save(),k.beginPath(),k.strokeStyle="#bbb",k.fillStyle="#000",k.textAlign=q,k.textBaseline=r,h(k,a,b),j.context(k)(n.map(function(b){var c=[l(b),m(f(a))];return e?c:c.reverse()}));var c=e?l(n[1]):m(f(a)),d=e?m(f(a)):l(n[1]);k.fillText(g(a),c+o,d+p),k.fill(),k.stroke(),k.closePath(),k.restore()})};return k.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],k):a},k.yScale=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],k):c},k.value=function(){return arguments.length?(f=q(0>=arguments.length?void 0:arguments[0]),k):f},k.label=function(){return arguments.length?(g=q(0>=arguments.length?void 0:arguments[0]),k):g},k.decorate=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],k):h},k.orient=function(){return arguments.length?(i=0>=arguments.length?void 0:arguments[0],k):i},s(k,j,"context"),k},P=function(){var a=b.scaleIdentity(),c=[10],d=null,e=function(){var b;return null==d?a.ticks?(b=a).ticks.apply(b,g(c)):a.domain():d};return e.scale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],e):a},e.ticks=function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c=b,e},e.tickArguments=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],e):c},e.tickValues=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],e):d},e},Q=function(a){return a};a.annotationCanvasBand=function(){var a=b.scaleIdentity(),c=b.scaleIdentity(),d="horizontal",e=function(a){return a.from},f=function(a){return a.to},g=function(){},h=p().horizontalAlign("right").verticalAlign("top"),i=function(b){if("horizontal"!==d&&"vertical"!==d)throw new Error("Invalid orientation");var j=h.context(),k="horizontal"===d,l=k?a:c,m=k?c:a,n=l.range(),o=n[1]-n[0],p=k?"x":"y",q=k?"y":"x",r=k?"height":"width",s=k?"width":"height";b.forEach(function(a,b){j.save(),j.beginPath(),j.strokeStyle="transparent",h[q](m(e(a))),h[p](n[0]),h[s](o),h[r](m(f(a))-m(e(a))),g(j,a,b),h.context(j)([a],b),j.fill(),j.stroke(),j.closePath(),j.restore()})};return i.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],i):a},i.yScale=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],i):c},i.orient=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],i):d},i.decorate=function(){return arguments.length?(g=0>=arguments.length?void 0:arguments[0],i):g},i.fromValue=function(){return arguments.length?(e=q(0>=arguments.length?void 0:arguments[0]),i):e},i.toValue=function(){return arguments.length?(f=q(0>=arguments.length?void 0:arguments[0]),i):f},s(i,h,"context"),i},a.annotationCanvasCrosshair=function(){var a=function(a){return a.x},c=function(a){return a.y},e=b.scaleIdentity(),f=b.scaleIdentity(),g=K(),h=O(),i=O().orient("vertical"),j=b.scaleIdentity(),k=b.scaleIdentity(),l=N().series([h,i,g]).xScale(j).yScale(k).mapping(function(a){return[a]}),m=function(b){b.forEach(function(b){j.range(e.range()),k.range(f.range()),g.crossValue(a).mainValue(c),h.value(c),i.value(a),l(b)})};m.x=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],m):a},m.y=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],m):c},m.xScale=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],m):e},m.yScale=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],m):f};var n=z("label","decorate");return u(m,h,n,C("y")),u(m,i,n,C("x")),s(m,g,"decorate"),s(m,l,"context"),m},a.annotationCanvasGridline=function(){var a=function(){},b=function(){},c=P(),d=P(),f=e.line(),g=function(){var e=f.context(),g=c.scale(),h=d.scale();c().forEach(function(b,c){e.save(),e.beginPath(),e.strokeStyle="#bbb",e.fillStyle="transparent",a(e,b,c),f.context(e)(h.domain().map(function(a){return[g(b),h(a)]})),e.fill(),e.stroke(),e.closePath(),e.restore()}),d().forEach(function(a,c){e.save(),e.beginPath(),e.strokeStyle="#bbb",e.fillStyle="transparent",b(e,a,c),f.context(e)(g.domain().map(function(b){return[g(b),h(a)]})),e.fill(),e.stroke(),e.closePath(),e.restore()})};return g.yDecorate=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],g):b},g.xDecorate=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],g):a},u(g,c,C("x")),u(g,d,C("y")),s(g,f,"context"),g},a.annotationCanvasLine=O,a.annotationSvgBand=function(){var a=b.scaleIdentity(),d=b.scaleIdentity(),e="horizontal",f=function(a){return a.from},g=function(a){return a.to},h=function(){},i=n("g","annotation-band"),j=p().horizontalAlign("center").verticalAlign("center").x(0).y(0),k=function(b){if(b.selection&&i.transition(b),"horizontal"!==e&&"vertical"!==e)throw new Error("Invalid orientation");var k="horizontal"===e,l=k?function(c,a){return"translate(".concat(c,", ").concat(a,")")}:function(c,a){return"translate(".concat(a,", ").concat(c,")")},m=k?a:d,n=k?d:a,o=m.range(),p=o[1]-o[0],q=k?"height":"width",r=k?"width":"height",s=function(){return l((o[1]+o[0])/2,(n(g.apply(void 0,arguments))+n(f.apply(void 0,arguments)))/2)};j[r](p),j[q](function(){return n(g.apply(void 0,arguments))-n(f.apply(void 0,arguments))}),b.each(function(a,b,d){var f=i(c.select(d[b]),a);f.enter().attr("transform",s).append("path").classed("band",!0),f.attr("class","annotation-band ".concat(e)).attr("transform",s).select("path").attr("d",function(a,b){return j([a],b)}),h(f,a,b)})};return k.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],k):a},k.yScale=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],k):d},k.orient=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],k):e},k.decorate=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],k):h},k.fromValue=function(){return arguments.length?(f=q(0>=arguments.length?void 0:arguments[0]),k):f},k.toValue=function(){return arguments.length?(g=q(0>=arguments.length?void 0:arguments[0]),k):g},k},a.annotationSvgCrosshair=function(){var a=function(a){return a.x},d=function(a){return a.y},e=b.scaleIdentity(),f=b.scaleIdentity(),h=function(){},i=n("g","annotation-crosshair"),j=J(),k=D(),l=D().orient("vertical"),m=b.scaleIdentity(),o=b.scaleIdentity(),p=M().series([k,l,j]).xScale(m).yScale(o).mapping(function(a){return[a]}),q=function(b){b.selection&&i.transition(b),b.each(function(b,n,q){var r=i(c.select(q[n]),b);r.enter().style("pointer-events","none"),m.range(e.range()),o.range(f.range()),j.crossValue(a).mainValue(d),k.value(d),l.value(a),r.call(p),h(r,b,n)})};q.x=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],q):a},q.y=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],q):d},q.xScale=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],q):e},q.yScale=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],q):f},q.decorate=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],q):h};var r=z("label");return u(q,k,r,C("y")),u(q,l,r,C("x")),q},a.annotationSvgGridline=function(){var a=function(){},b=function(){},d=P(),e=P(),f=n("line","gridline-y").key(Q),g=n("line","gridline-x").key(Q),h=function(h){h.selection&&(f.transition(h),g.transition(h)),h.each(function(h,i,j){var k=j[i],l=c.select(j[i]),m=d.scale(),n=e.scale(),o=k.__x_scale__||m;k.__x_scale__=m.copy();var p=d(),q=f(l,p);q.enter().attr("x1",o).attr("x2",o).attr("y1",n.range()[0]).attr("y2",n.range()[1]),q.attr("x1",m).attr("x2",m).attr("y1",n.range()[0]).attr("y2",n.range()[1]).attr("stroke","#bbb"),q.exit().attr("x1",m).attr("x2",m),a(q,p,i);var r=k.__y_scale__||n;k.__y_scale__=n.copy();var s=e(),t=g(l,s);t.enter().attr("y1",r).attr("y2",r).attr("x1",m.range()[0]).attr("x2",m.range()[1]),t.attr("y1",n).attr("y2",n).attr("x1",m.range()[0]).attr("x2",m.range()[1]).attr("stroke","#bbb"),t.exit().attr("y1",n).attr("y2",n),b(t,s,i)})};return h.yDecorate=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],h):b},h.xDecorate=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],h):a},u(h,f,A({key:"xKey"})),u(h,g,A({key:"yKey"})),u(h,d,C("x")),u(h,e,C("y")),h},a.annotationSvgLine=D,Object.defineProperty(a,"__esModule",{value:!0})});
