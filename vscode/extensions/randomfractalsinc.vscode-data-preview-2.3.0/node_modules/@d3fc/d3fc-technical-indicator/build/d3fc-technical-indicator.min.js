(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],b):(a=a||self,b(a.fc=a.fc||{},a.d3))})(this,function(a,b){'use strict';function c(a){return a}function d(){}function e(a){return"function"==typeof a?a:function(){return a}}function f(a){return"number"==typeof a&&isNaN(a)?void 0:a}function g(){var a=function(){return 10},b=d,f=c,g=function(a){return null!=a},h=function(c){var e=a.apply(this,arguments),h=c.slice(0,e).map(f);return c.map(function(a,c){return c>=e&&(h.shift(),h.push(f(a,c))),c<e-1||h.some(function(a){return!g(a)})?b(void 0,c):b(h,c)})};return h.period=function(){return arguments.length?(a=e(0>=arguments.length?void 0:arguments[0]),h):a},h.accumulator=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],h):b},h.defined=function(){return arguments.length?(g=0>=arguments.length?void 0:arguments[0],h):g},h.value=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],h):f},h}function h(){var a=2,c=g().accumulator(function(c){var d=c&&b.deviation(c),e=c&&b.mean(c);return{average:e,upper:f(e+a*d),lower:f(e-a*d)}}),d=function(a){return c(a)};return d.multiplier=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],d):a},w(d,c,"period","value"),d}function i(){var a=c,d=function(){return 9},g=function(a){var c=[];return function(d){var e;return c.length<a&&(null==d?c=[]:c.push(d)),c.length>=a&&(e=b.mean(c)),e}},h=function(b){var c,e=d.apply(this,arguments),h=2/(e+1),j=g(e);return b.map(function(b,d){var e=a(b,d);return c=void 0===c?j(e):e*h+(1-h)*c,f(c)})};return h.period=function(){return arguments.length?(d=e(0>=arguments.length?void 0:arguments[0]),h):d},h.value=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],h):a},h}function j(){var a=c,d=i().period(12),e=i().period(26),f=i().period(9),g=function(c){d.value(a),e.value(a);var g=b.zip(d(c),e(c)).map(function(a){return void 0!==a[0]&&void 0!==a[1]?a[0]-a[1]:void 0}),h=f(g);return b.zip(g,h).map(function(a){return{macd:a[0],signal:a[1],divergence:void 0!==a[0]&&void 0!==a[1]?a[0]-a[1]:void 0}})};return g.value=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],g):a},y(g,d,z({period:"fastPeriod"})),y(g,e,z({period:"slowPeriod"})),y(g,f,z({period:"signalPeriod"})),g}function k(a,b){return n(a)||p(a,b)||r()}function l(a){return m(a)||o(a)||q()}function m(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function n(a){if(Array.isArray(a))return a}function o(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function p(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function q(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function s(){var a=g().accumulator(function(a){return a&&b.mean(a)}),c=function(b){return a(b)};return w(c,a,"period","value"),c}function t(){var a=.1,b=c,d=function(c){return c.map(function(c){var d=f(b(c)*(1-a)),e=f(b(c)*(1+a));return{lower:d,upper:e}})};return d.factor=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],d):a},d.value=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],d):b},d}function u(){var a=function(a){return a.close},c=function(a){return a.high},e=function(a){return a.low},g=i().period(13),h=function(d){return g.value(a),b.zip(d,g(d)).map(function(a){var b=f(c(a[0])-a[1]),d=f(e(a[0])-a[1]);return{bullPower:b,bearPower:d}})};return h.closeValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],h):a},h.highValue=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],h):c},h.lowValue=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],h):e},w(h,g,"period"),h}var v=(a,b,c)=>{const d=b[c];if("function"!=typeof d)throw new Error(`Attempt to rebind ${c} which isn't a function on the source object`);return(...c)=>{var e=d.apply(b,c);return e===b?a:e}},w=(a,b,...c)=>{for(const d of c)a[d]=v(a,b,d);return a};const x=a=>b=>a.reduce((a,b)=>a&&b(a),b);var y=(a,b,...c)=>{const d=x(c);for(const e of Object.keys(b)){const c=d(e);c&&(a[c]=v(a,b,e))}return a},z=a=>b=>a[b];a.indicatorBollingerBands=h,a.indicatorElderRay=u,a.indicatorEnvelope=t,a.indicatorExponentialMovingAverage=i,a.indicatorForceIndex=function(){var a=function(a){return a.volume},b=function(a){return a.close},c=i().period(13),d=g().period(2).defined(function(c){return null!=b(c)&&null!=a(c)}).accumulator(function(c){return c&&f((b(c[1])-b(c[0]))*a(c[1]))}),e=function(a){var b=d(a);return c(b)};return e.volumeValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],e):a},e.closeValue=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],e):b},w(e,c,"period"),e},a.indicatorMacd=j,a.indicatorMovingAverage=s,a.indicatorRelativeStrengthIndex=function(){var a=g().period(14),c=function(a,b){return b+(a[a.length-1]-b)/a.length},d=function(a){var b=k(a,2),c=b[0],d=b[1];return c<d?0:c-d},e=function(a){var b=k(a,2),c=b[0],d=b[1];return c>d?0:d-c},h=function(a,d){return void 0===d?b.mean(a):c(a,d)},i=function(){var a,c,g;return function(i){if(!i)return void(void 0!==a&&(a=NaN));if(void 0===a)return void(a=i[0]);var j=b.pairs([a].concat(l(i)));c=h(j.map(d),c),g=h(j.map(e),g);var k=isNaN(a)?NaN:g/c;return f(100-100/(1+k))}},j=function(b){var c=i();return a.accumulator(c),a(b)};return w(j,a,"period","value"),j},a.indicatorStochasticOscillator=function(){var a=function(a){return a.close},c=function(a){return a.high},e=function(a){return a.low},h=g().period(5).defined(function(b){return null!=a(b)&&null!=c(b)&&null!=e(b)}).accumulator(function(d){var g=d&&b.max(d,c),h=d&&b.min(d,e),i=d&&100*(a(d[d.length-1])-h)/(g-h);return f(i)}),i=s().period(3),j=function(a){var b=h(a),c=i(b);return b.map(function(a,b){return{k:a,d:c[b]}})};return j.closeValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],j):a},j.highValue=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],j):c},j.lowValue=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],j):e},y(j,h,z({period:"kPeriod"})),y(j,i,z({period:"dPeriod"})),j},Object.defineProperty(a,"__esModule",{value:!0})});
