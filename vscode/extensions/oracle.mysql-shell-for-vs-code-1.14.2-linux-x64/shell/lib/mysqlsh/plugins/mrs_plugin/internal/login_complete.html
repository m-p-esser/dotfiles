<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Login completed.</title>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
        button {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 6px 26px;
          font-family: -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
          font-weight: 300;
          border-radius: 6px;
          border: none;
          background: #6E6D70;
          box-shadow: 0px 0.5px 1px rgba(0, 0, 0, 0.1), inset 0px 0.5px 0.5px rgba(255, 255, 255, 0.5), 0px 0px 0px 0.5px rgba(0, 0, 0, 0.12);
          color: #DFDEDF;
          user-select: none;
          -webkit-user-select: none;
          touch-action: manipulation;
        }
        button:active {
          box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.3) inset;
        }
        .main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 200;
        }
        .hidden {
          display: none;
        }

        @media (prefers-color-scheme: dark) {
          html, body {
            background-color: #181818;
            color: #aaa;
          }
          button {
            box-shadow: 0px 0.5px 1px rgba(0, 0, 0, 0.1);
            background-color: #ccc;
            color: #3D3D3D;
          }
        }
    </style>
  </head>
  <body>
    <div class="main">
        <p id="loginStatus">Login completed.</p>
        <button id="closeBtn" class="hidden" onClick="window.close();">Close</button>
    </div>
    <script>
      (function() {
        // Fetch URL parameters
        const params = new Proxy(new URLSearchParams(window.location.search), {
          get: (searchParams, prop) => searchParams.get(prop),
        });

        // Helper function to check if value is an integer
        function isInt(value) {
          return !isNaN(value) && 
                parseInt(Number(value)) == value && 
                !isNaN(parseInt(value, 10));
        }

        // Handle login parameter values
        if (params.login === "success") {
          document.getElementById("loginStatus").innerHTML = "Login completed successfully.";
        } else if (params.login) {
          document.getElementById("loginStatus").innerHTML = "Login failed.";
        }

        // Handle onCompletionClose parameter values. This only works in popup windows.
        if (params.onCompletionClose === "manual") {
          document.getElementById("closeBtn").classList.remove("hidden");
        } else if (isInt(params.onCompletionClose)) {
          setTimeout(() => { window.close(); }, 1000 * parseInt(params.onCompletionClose, 10));
        }
      }())
    </script>
  </body>
</html>